<h1>이벤트 메일링 등록/검색</h1>
<%= form_for(@event_mailing_list) do |f| %>
	<div>
		<%= f.text_field :email %>
		<input type="button" id="go" value="메일등록/검색" />
	</div>
<% end %>

<% if @mail %>
<div id="my_email" style="margin-top: 20px;">
	<table>
		<tr>
			<td><%= @mail.email %></td>
			<td>
				<input id="mail_receive_true" type="button" value="메일 받기" />
				<input id="mail_receive_false" type="button" value="메일 안받기" />
			</td>
			<td>
				<input id="del_mail" type="button" value="메일 삭제" />
			</td>
			<td>
				현재상태: 
					<span id="send_status_true" style="background-color: blue; color: white; padding:5px">메일 받음</span>
					<span id="send_status_false" style="background-color: red; color: white; padding:5px">메일 안받음</span>
			</td>
		</tr>
	</table>
</div>
<% end %>


<script>
	$('#go').click(function(){
		var email = $.trim( $("#event_mailing_list_email").val() );  
	  	if ( email == "" || email == "" ) {
	  		alert("email 입력해주세요.");
	  		return false;
	  	} else {
	  		$("#new_event_mailing_list").submit();
	  	}
	});
</script>

<% if @mail %>
<script>
	$('#mail_receive_false').click(function(){
		$.ajax({
		   url: "/event_mailing_lists/mail_receive_false",
		   dataType:'json',
		   data: {mail_id: <%= @mail.id %>},
		   type:'PUT',
		   success: function(data){
		   	mail_send_false();
		       alert("이벤트를 이메일로 전송하지 않습니다.");
		   }
		});
	});
	
	$('#mail_receive_true').click(function(){
		$.ajax({
		   url: "/event_mailing_lists/mail_receive_true",
		   dataType:'json',
		   data: {mail_id: <%= @mail.id %>},
		   type:'PUT',
		   success: function(data){
		   	mail_send_true();
		       alert("이벤트를 이메일로 전송합니다.");
		   }
		});
	});
	
	$('#del_mail').click(function(){
		$.ajax({
		   url: "/event_mailing_lists/del_mail",
		   dataType:'json',
		   data: {mail_id: <%= @mail.id %>},
		   type:'DELETE',
		   success: function(data){
		       alert("메일주소가 삭제 되었습니다.");
		       $("#my_email").remove();
		   }
		});
	});
	
	<% if @mail.send_flg %>
		mail_send_true();
	<% else %>
		mail_send_false();
	<% end %>
	
	function mail_send_true(){
		$("#send_status_true").show();
		$("#send_status_false").hide();
	}
	
	function mail_send_false(){
		$("#send_status_true").hide();
		$("#send_status_false").show();
	}
</script>
<% end %>
